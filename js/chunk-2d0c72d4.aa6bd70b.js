(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2d0c72d4"],{5003:function(t,e,a){"use strict";a.r(e);var s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("Content",[a("Row",[a("Col",{attrs:{span:"16"}},[a("Content",{staticStyle:{padding:"5px"}},[a("Card",[a("Form",{ref:"formValidate",attrs:{model:t.formValidate,rules:t.ruleValidate,"label-width":80}},[a("FormItem",{attrs:{label:"标题",prop:"title"}},[a("Input",{attrs:{placeholder:"title"},model:{value:t.formValidate.title,callback:function(e){t.$set(t.formValidate,"title",e)},expression:"formValidate.title"}})],1),a("FormItem",{attrs:{label:"权限",prop:"privilege"}},[a("i-switch",{attrs:{size:"large"},model:{value:t.formValidate.privilege,callback:function(e){t.$set(t.formValidate,"privilege",e)},expression:"formValidate.privilege"}},[a("span",{attrs:{slot:"open"},slot:"open"},[t._v("私有")]),a("span",{attrs:{slot:"close"},slot:"close"},[t._v("公开")])])],1)],1)],1)],1)],1),a("Col",{attrs:{span:"8"}},[a("Sider",{attrs:{width:"100%","hide-trigger":""}},[a("div",{staticStyle:{"background-color":"#f8f8f9",padding:"5px"}},[a("Card",{staticClass:"NewsCard"},[a("p",{attrs:{slot:"title"},slot:"title"},[t._v("新闻信息")]),a("p",{attrs:{slot:"extra"},slot:"extra"},[a("Button",{attrs:{type:"primary",loading:t.btnLoading},on:{click:function(e){return t.handleSubmit("formValidate")}}},[t._v("提交")]),a("Button",{attrs:{type:"error",to:"/manage/news"}},[t._v("列表")])],1),a("Table",{attrs:{columns:t.tableCol,data:t.newsData,"show-header":!1}})],1)],1)])],1)],1),a("Card",[a("mavon-editor",{ref:"editor",staticStyle:{"min-height":"600px"},on:{imgAdd:t.$imgAdd,save:t.saveContent},model:{value:t.content,callback:function(e){t.content=e},expression:"content"}})],1)],1)},i=[],n=(a("6b54"),{name:"NewsEdit",data(){return{btnLoading:!0,formValidate:{title:"",privilege:!1},ruleValidate:{title:[{required:!0,message:"标题不能为空！",trigger:"blur"}]},content:"",tableCol:[{key:"name"},{key:"info"}],newsData:[]}},mounted(){var t=new URLSearchParams;this.$store.state.loginInfo.isLogin&&(t.append("user_id",this.$store.state.loginInfo.user_id),t.append("token",this.$store.state.loginInfo.token)),axios.get(this.$store.state.API_ROOT+"news/"+this.$route.params.id+"?"+t.toString()).then(t=>{this.formValidate.title=t.data.data.news.title,this.formValidate.privilege=1==t.data.data.news.privilege,this.content=t.data.data.news.content;let e=Array();e[0]=t.data.data.newsData[0],e[1]=t.data.data.newsData[1],this.newsData=e,this.btnLoading=!1}).catch(function(t){console.log(t)})},methods:{saveContent:function(){this.$Spin.show();var t=new URLSearchParams;t.append("user_id",this.$store.state.loginInfo.user_id),t.append("token",this.$store.state.loginInfo.token),t.append("content",this.content),this.btnLoading=!0,axios.post(this.$store.state.API_ROOT+"news/"+this.$route.params.id+"/edit",t).then(t=>{t.data.data.is_ok?(this.newsData[1]["info"]=this.$store.state.server_time,this.$Message.success("保存成功！")):this.$Message.error("保存失败！"),this.btnLoading=!1,this.$Spin.hide()}).catch(function(t){this.$Message.error("保存失败！"),this.btnLoading=!1,this.$Spin.hide()})},handleSubmit(t){this.$refs[t].validate(t=>{if(t){this.$Spin.show(),this.btnLoading=!0;var e=new URLSearchParams;e.append("user_id",this.$store.state.loginInfo.user_id),e.append("token",this.$store.state.loginInfo.token),e.append("title",this.formValidate.title),e.append("privilege",this.formValidate.privilege?1:0),e.append("tags",this.formValidate.tags),e.append("content",this.content),axios.post(this.$store.state.API_ROOT+"news/"+this.$route.params.id+"/edit",e).then(t=>{this.$Spin.hide(),t.data.data.is_ok?(this.newsData[1]["info"]=this.$store.state.server_time,this.btnLoading=!1,this.$Message.success("保存成功！")):(this.btnLoading=!1,this.$Message.error("保存失败！"))}).catch(function(t){this.$Spin.hide(),this.btnLoading=!1,this.$Message.error("保存失败！")})}else this.$Message.error("请检查输入!")})},$imgAdd(t,e){this.$Spin.show(),axios.get(this.$store.state.API_ROOT+"upload/token").then(a=>{this.uploadToken=a.data.data.token;var s=new URLSearchParams;s.append("token",this.uploadToken),s.append("file",e);var i=new FormData;i.append("token",this.uploadToken),i.append("file",e),axios.post("https://upload.qiniup.com",i).then(e=>{this.$refs.editor.$img2Url(t,this.$store.state.CDN_ROOT+e.data.key),this.$Spin.hide(),this.$Message.success("图片上传成功！")}).catch(function(t){console.log(t)})}).catch(function(t){console.log(t)})}}}),o=n,r=a("2877"),l=Object(r["a"])(o,s,i,!1,null,null,null);e["default"]=l.exports}}]);
//# sourceMappingURL=chunk-2d0c72d4.aa6bd70b.js.map